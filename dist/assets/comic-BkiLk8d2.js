import{L as z,M as A,N as F,r as S,c as N}from"./index-CD-uQSen.js";var O={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */var H=O.exports,E;function I(){return E||(E=1,function(e,n){(function(t,s){e.exports=s()})(H,function(){var t={};t.version="0.2.0";var s=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};t.configure=function(r){var o,a;for(o in r)a=r[o],a!==void 0&&r.hasOwnProperty(o)&&(s[o]=a);return this},t.status=null,t.set=function(r){var o=t.isStarted();r=l(r,s.minimum,1),t.status=r===1?null:r;var a=t.render(!o),m=a.querySelector(s.barSelector),y=s.speed,w=s.easing;return a.offsetWidth,f(function(d){s.positionUsing===""&&(s.positionUsing=t.getPositioningCSS()),i(m,C(r,y,w)),r===1?(i(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout(function(){i(a,{transition:"all "+y+"ms linear",opacity:0}),setTimeout(function(){t.remove(),d()},y)},y)):setTimeout(d,y)}),this},t.isStarted=function(){return typeof t.status=="number"},t.start=function(){t.status||t.set(0);var r=function(){setTimeout(function(){t.status&&(t.trickle(),r())},s.trickleSpeed)};return s.trickle&&r(),this},t.done=function(r){return!r&&!t.status?this:t.inc(.3+.5*Math.random()).set(1)},t.inc=function(r){var o=t.status;return o?(typeof r!="number"&&(r=(1-o)*l(Math.random()*o,.1,.95)),o=l(o+r,0,.994),t.set(o)):t.start()},t.trickle=function(){return t.inc(Math.random()*s.trickleRate)},function(){var r=0,o=0;t.promise=function(a){return!a||a.state()==="resolved"?this:(o===0&&t.start(),r++,o++,a.always(function(){o--,o===0?(r=0,t.done()):t.set((r-o)/r)}),this)}}(),t.render=function(r){if(t.isRendered())return document.getElementById("nprogress");b(document.documentElement,"nprogress-busy");var o=document.createElement("div");o.id="nprogress",o.innerHTML=s.template;var a=o.querySelector(s.barSelector),m=r?"-100":v(t.status||0),y=document.querySelector(s.parent),w;return i(a,{transition:"all 0 linear",transform:"translate3d("+m+"%,0,0)"}),s.showSpinner||(w=o.querySelector(s.spinnerSelector),w&&M(w)),y!=document.body&&b(y,"nprogress-custom-parent"),y.appendChild(o),o},t.remove=function(){L(document.documentElement,"nprogress-busy"),L(document.querySelector(s.parent),"nprogress-custom-parent");var r=document.getElementById("nprogress");r&&M(r)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var r=document.body.style,o="WebkitTransform"in r?"Webkit":"MozTransform"in r?"Moz":"msTransform"in r?"ms":"OTransform"in r?"O":"";return o+"Perspective"in r?"translate3d":o+"Transform"in r?"translate":"margin"};function l(r,o,a){return r<o?o:r>a?a:r}function v(r){return(-1+r)*100}function C(r,o,a){var m;return s.positionUsing==="translate3d"?m={transform:"translate3d("+v(r)+"%,0,0)"}:s.positionUsing==="translate"?m={transform:"translate("+v(r)+"%,0)"}:m={"margin-left":v(r)+"%"},m.transition="all "+o+"ms "+a,m}var f=function(){var r=[];function o(){var a=r.shift();a&&a(o)}return function(a){r.push(a),r.length==1&&o()}}(),i=function(){var r=["Webkit","O","Moz","ms"],o={};function a(d){return d.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(u,c){return c.toUpperCase()})}function m(d){var u=document.body.style;if(d in u)return d;for(var c=r.length,p=d.charAt(0).toUpperCase()+d.slice(1),g;c--;)if(g=r[c]+p,g in u)return g;return d}function y(d){return d=a(d),o[d]||(o[d]=m(d))}function w(d,u,c){u=y(u),d.style[u]=c}return function(d,u){var c=arguments,p,g;if(c.length==2)for(p in u)g=u[p],g!==void 0&&u.hasOwnProperty(p)&&w(d,p,g);else w(d,c[1],c[2])}}();function h(r,o){var a=typeof r=="string"?r:P(r);return a.indexOf(" "+o+" ")>=0}function b(r,o){var a=P(r),m=a+o;h(a,o)||(r.className=m.substring(1))}function L(r,o){var a=P(r),m;h(r,o)&&(m=a.replace(" "+o+" "," "),r.className=m.substring(1,m.length-1))}function P(r){return(" "+(r.className||"")+" ").replace(/\s+/gi," ")}function M(r){r&&r.parentNode&&r.parentNode.removeChild(r)}return t})}(O)),O.exports}var V=I();const j=z(V),J=A.create({baseURL:"/api",timeout:15e3});J.interceptors.request.use(e=>(j.start(),e),e=>(j.done(),Promise.reject(e)));J.interceptors.response.use(e=>(j.done(),e.data),e=>(j.done(),Promise.reject(e)));function k(e,n,t){return J.get(e,{params:n,...t}).then(s=>s)}const G=[{id:"482543",title:"[哇哈哈漢化](C102)[CHIEUCHI(骨彥)]欲情翼下の生徒會(ブルーアーカイブ)[中國翻譯]",cover:"/src/assets/mock/482543/00001.webp",author:"未知",description:"从JM漫画下载的漫画",tags:["校园"],updateTime:"2025-03-07",status:"completed"},{id:"540836",title:"[下江小春漢化組] [Digital] [NNL (メリサン)] 先生、お加減どうですか_ (ブルーアーカイブ)",cover:"/src/assets/mock/540836/00001.webp",author:"未知",description:"从JM漫画下载的漫画",tags:["校园"],updateTime:"2025-03-08",status:"completed"},{id:"364547",title:"[觀用少女 (こもた)] Connect-少女は觸手と愛をつむぐ- 後編[中國翻譯]",cover:"/src/assets/mock/364547/00001.webp",author:"未知",description:"从JM漫画下载的漫画",tags:["百合"],updateTime:"2025-03-08",status:"completed"},{id:"478542",title:"[白楊漢化組] (C102) [うつすみおんせん (空住キオ)] その照準の先に見ゆ (ブルーアーカイブ) [DL版] [中國翻譯]",cover:"/src/assets/mock/478542/00001.webp",author:"未知",description:"从JM漫画下载的漫画",tags:["漫画","JM漫画"],updateTime:"2025-03-08",status:"completed"}],K=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"})),Q=[{id:"482543-1",comicId:"482543",title:"第1话",order:1,updateTime:"2025-03-07",pageCount:23},{id:"540836-1",comicId:"540836",title:"第1话",order:1,updateTime:"2025-03-08",pageCount:23},{id:"364547-1",comicId:"364547",title:"第1话",order:1,updateTime:"2025-03-08",pageCount:69},{id:"478542-1",comicId:"478542",title:"第1话",order:1,updateTime:"2025-03-08",pageCount:30}],X=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"})),D=Array.from({length:16},(e,n)=>`/src/assets/mock/小魔仙/${(n+1).toString().padStart(5,"0")}.png`);let B=[];try{const e=Object.assign({"/src/assets/mock/comics.json":K}),n=Object.keys(e)[0];n&&(B=(e[n].default||[]).map(s=>({...s,status:s.status==="completed"?"completed":"ongoing"})))}catch(e){console.warn("无法加载comics.json文件",e)}let W=[];try{const e=Object.assign({"/src/assets/mock/chapters.json":X}),n=Object.keys(e)[0];n&&(W=e[n].default||[])}catch(e){console.warn("无法加载chapters.json文件",e)}function Y(){return[...[{id:"1",title:"小魔仙",cover:D[0],author:"小魔仙作者",description:"百合小漫画",tags:["百合"],updateTime:new Date().toISOString().split("T")[0],status:"completed"}],...B]}function Z(e){if(e.toString()==="1")return[{id:`${e}-1`,comicId:e,title:"第1话:神秘的开始",order:1,updateTime:new Date().toISOString().split("T")[0],pageCount:D.length,cover:D[0]}];const n=W.filter(t=>t.comicId.toString()===e.toString());return n.length>0?n:[]}function q(e){var f;if(e.toString()==="1-1")return D.map((i,h)=>({id:`${e}-${h+1}`,chapterId:e,order:h+1,url:i}));const[n,t]=e.toString().split("-");if(!n||!t)return[];const s=R(n);if(!s)return[];const l=(f=s.chapters)==null?void 0:f.find(i=>i.id===e);if(!l)return[];const v=l.pageCount||0,C=[];for(let i=1;i<=v;i++){const h=i.toString().padStart(5,"0");C.push({id:`${e}-${i}`,chapterId:e,order:i,url:`/src/assets/mock/${n}/${h}.webp`})}return C}let x=null;function _(){return x||(x=Y()),x}function $(e=1,n=20){const t=_(),s=(e-1)*n,l=s+n;return{items:t.slice(s,l),total:t.length,page:e,pageSize:n,hasMore:l<t.length}}function R(e){const n=_().find(t=>t.id.toString()===e.toString());return n&&!n.chapters&&(n.chapters=Z(e)),n||null}function U(e){const{keyword:n,tags:t}=e;let s=_();n&&(s=s.filter(h=>h.title.toLowerCase().includes(n.toLowerCase())||h.author.toLowerCase().includes(n.toLowerCase())||h.description.toLowerCase().includes(n.toLowerCase()))),t&&t.length>0&&(s=s.filter(h=>t.every(b=>h.tags.includes(b))));const l=e.page||1,v=e.pageSize||20,C=(l-1)*v,f=C+v;return{items:s.slice(C,f),total:s.length,page:l,pageSize:v,hasMore:f<s.length}}const T=!1;async function ee(e=1,n=20){try{if(!T){const t=await k("/comics",{page:e,pageSize:n});if(t&&t.items.length>0)return t}return $(e,n)}catch(t){return console.warn("获取漫画列表失败, 使用mock数据",t),$(e,n)}}async function te(e){try{if(!T){const n=await k(`/comics/${e}`);if(n)return n}return R(e)}catch(n){return console.warn("获取漫画详情失败, 使用mock数据",n),R(e)}}async function re(e){try{if(!T){const n=await k(`/chapters/${e}/pages`);if(n&&n.length>0)return n}return q(e)}catch(n){return console.warn("获取章节页面失败, 使用mock数据",n),q(e)}}async function ne(e){try{if(!T){const n=await k("/comics/search",e);if(n&&n.items.length>0)return n}return U(e)}catch(n){return console.warn("搜索漫画失败,使用mock数据",n),U(e)}}async function se(e=10){try{if(!T){const t=await k("/comics/latest",{limit:e});if(t&&t.length>0)return t}return $(1,e).items.sort((t,s)=>new Date(s.updateTime).getTime()-new Date(t.updateTime).getTime())}catch(n){return console.warn("获取最新漫画失败, 使用mock数据",n),$(1,e).items.sort((s,l)=>new Date(l.updateTime).getTime()-new Date(s.updateTime).getTime())}}async function oe(e=6){try{if(!T){const s=await k("/comics/recommended",{limit:e});if(s&&s.length>0)return s}return[..._()].sort(()=>.5-Math.random()).slice(0,e)}catch(n){return console.warn("获取推荐漫画失败, 使用mock数据",n),[..._()].sort(()=>.5-Math.random()).slice(0,e)}}const ie=F("comic",()=>{const e=S([]),n=S([]),t=S([]),s=S([]),l=S(null),v=S(null),C=S([]),f=S(!1),i=S(null),h=N(()=>e.value.length>0),b=N(()=>l.value!==null),L=N(()=>v.value!==null),P=N(()=>C.value.length>0);async function M(u=1,c=20){try{f.value=!0,i.value=null;const p=await ee(u,c);return e.value=p.items,p}catch(p){throw i.value=p.message||"获取漫画列表失败",p}finally{f.value=!1}}async function r(u=10){try{f.value=!0,i.value=null,n.value=await se(u)}catch(c){i.value=c.message||"获取最新漫画失败"}finally{f.value=!1}}async function o(u=6){try{f.value=!0,i.value=null,t.value=await oe(u)}catch(c){i.value=c.message||"获取推荐漫画失败"}finally{f.value=!1}}async function a(u){try{f.value=!0,i.value=null;const c=await te(u);c?l.value=c:i.value="漫画不存在"}catch(c){i.value=c.message||"获取漫画详情失败"}finally{f.value=!1}}async function m(u){try{if(f.value=!0,i.value=null,l.value&&l.value.chapters){const[c,p]=u.toString().split("-").map(Number);l.value.id.toString()===c.toString()&&(v.value=l.value.chapters.find(g=>g.order===p)||null)}C.value=await re(u)}catch(c){i.value=c.message||"获取章节页面失败"}finally{f.value=!1}}async function y(u,c=1,p=20){try{return f.value=!0,i.value=null,await ne({keyword:u,page:c,pageSize:p})}catch(g){throw i.value=g.message||"搜索漫画失败",g}finally{f.value=!1}}async function w(u,c=1,p=20){try{return f.value=!0,i.value=null,await M(c,p),s.value=e.value.filter(g=>g.tags&&g.tags.includes(u)),{items:s.value,total:s.value.length,page:c,pageSize:p,hasMore:!1}}catch(g){throw i.value=g.message||"获取分类漫画失败",g}finally{f.value=!1}}function d(){e.value=[],n.value=[],t.value=[],s.value=[],l.value=null,v.value=null,C.value=[],i.value=null}return{comics:e,latestComics:n,recommendedComics:t,filteredComics:s,currentComic:l,currentChapter:v,currentPages:C,loading:f,error:i,hasComics:h,hasCurrentComic:b,hasCurrentChapter:L,hasCurrentPages:P,fetchComics:M,fetchLatestComics:r,fetchRecommendedComics:o,fetchComicDetail:a,fetchChapterPages:m,searchComics:y,fetchComicsByTag:w,resetState:d}});export{ie as u};
