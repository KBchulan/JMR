import{d as E,r as h,c as p,o as G,a as U,w as J,b as n,e as s,F as f,f as g,g as t,h as x,i as S,u as T,j as K,k as O,l as Q,m as l,n as q,p as W,t as V,q as X,s as Y,_ as Z}from"./index-CD-uQSen.js";import{u as ee}from"./comic-BkiLk8d2.js";import{S as M}from"./SectionTitle-KoLAdueA.js";import{C as te,a as A}from"./ComicGrid-apJGY1A-.js";const se={class:"home-view"},oe={class:"banner-section"},ae={class:"carousel-container"},ne={class:"carousel-wrapper"},le=["onClick"],ce=["src","alt"],re={class:"banner-content"},ie={class:"comic-author"},de={key:0,class:"comic-description"},ue={class:"carousel-controls"},me={class:"carousel-indicators"},ve=["onClick"],_e={class:"recommended-section"},he={class:"recommended-grid"},pe={key:0,class:"loading-container"},fe={key:1,class:"grid-container"},ge={class:"latest-section"},Ce={class:"latest-grid"},ke={key:0,class:"loading-container"},we={key:1,class:"grid-container"},ye={class:"comics-section"},be=E({__name:"HomeView",setup(Ie){const F=Q(),c=ee(),C=h(1),k=h(24),w=h(0),y=p(()=>c.loading),b=p(()=>c.comics),I=p(()=>c.recommendedComics.length>3?[...c.recommendedComics].sort(()=>.5-Math.random()).slice(0,3):c.recommendedComics),B=p(()=>c.latestComics.length>4?[...c.latestComics].sort(()=>.5-Math.random()).slice(0,4):c.latestComics),m=h([]),u=h(0),H=a=>{u.value=a};let v=null;const L=()=>{v&&clearInterval(v),v=window.setInterval(()=>{N()},5e3)},R=()=>{v&&(clearInterval(v),v=null)},N=()=>{u.value=(u.value+1)%m.value.length},j=()=>{u.value=(u.value-1+m.value.length)%m.value.length},z=()=>{const i=[...b.value,...I.value,...B.value].filter((d,_,o)=>_===o.findIndex(e=>e.id===d.id));if(i.length>0){const _=[...i].sort(()=>.5-Math.random()).slice(0,3);m.value=_.map(o=>{var e,r;return{id:o.id,title:o.title,description:((e=o.description)==null?void 0:e.substring(0,80))+(((r=o.description)==null?void 0:r.length)>80?"...":"")||"",author:o.author||"百合小漫",cover:o.cover}})}};G(async()=>{try{await c.fetchRecommendedComics(3),await c.fetchLatestComics(4);const a=await c.fetchComics(C.value,k.value);w.value=a.total,z(),L()}catch(a){console.error("加载首页数据失败",a)}}),U(()=>{R()});const D=async(a,i)=>{C.value=a,k.value=i;try{const d=await c.fetchComics(a,i);w.value=d.total}catch(d){console.error("加载漫画列表失败",d)}},$=a=>{F.push(`/comic/${a}`)};return J([()=>b.value,()=>I.value,()=>B.value],()=>{z()}),(a,i)=>{const d=S("el-button"),_=S("el-icon"),o=S("el-skeleton");return l(),n("div",se,[s("div",oe,[s("div",ae,[s("div",ne,[(l(!0),n(f,null,g(m.value,(e,r)=>(l(),n("div",{key:r,class:q(["carousel-item",{active:r===u.value}]),onClick:P=>$(e.id)},[s("img",{src:e.cover,alt:e.title},null,8,ce),s("div",re,[s("h3",null,V(e.title),1),s("p",ie,V(e.author||"百合小漫"),1),e.description?(l(),n("p",de,V(e.description),1)):W("",!0),t(d,{type:"primary",size:"small",class:"banner-button",onClick:Y(P=>$(e.id),["stop"])},{default:x(()=>i[0]||(i[0]=[X(" 立即阅读 ")])),_:2},1032,["onClick"])])],10,le))),128))]),s("div",ue,[s("button",{class:"carousel-arrow prev-arrow",onClick:j},[t(_,null,{default:x(()=>[t(T(K))]),_:1})]),s("div",me,[(l(!0),n(f,null,g(m.value,(e,r)=>(l(),n("span",{key:r,class:q(["indicator-dot",{active:u.value===r}]),onClick:P=>H(r)},null,10,ve))),128))]),s("button",{class:"carousel-arrow next-arrow",onClick:N},[t(_,null,{default:x(()=>[t(T(O))]),_:1})])])])]),s("div",_e,[t(M,{title:"推荐漫画","more-link":"/ranking"}),s("div",he,[y.value?(l(),n("div",pe,[t(o,{rows:2,animated:""}),t(o,{rows:2,animated:""}),t(o,{rows:2,animated:""})])):(l(),n("div",fe,[(l(!0),n(f,null,g(I.value,e=>(l(),n("div",{key:e.id,class:"grid-item"},[t(A,{comic:e},null,8,["comic"])]))),128))]))])]),s("div",ge,[t(M,{title:"最新更新","more-link":"/latest"}),s("div",Ce,[y.value?(l(),n("div",ke,[t(o,{rows:2,animated:""}),t(o,{rows:2,animated:""}),t(o,{rows:2,animated:""})])):(l(),n("div",we,[(l(!0),n(f,null,g(B.value,e=>(l(),n("div",{key:e.id,class:"grid-item"},[t(A,{comic:e},null,8,["comic"])]))),128))]))])]),s("div",ye,[t(M,{title:"全部漫画","more-link":"/category"}),t(te,{comics:b.value,loading:y.value,pagination:!0,total:w.value,"default-page":C.value,"default-page-size":k.value,onPageChange:D},null,8,["comics","loading","total","default-page","default-page-size"])])])}}}),Me=Z(be,[["__scopeId","data-v-844f648b"]]);export{Me as default};
