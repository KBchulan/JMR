import{d as ce,r as m,C as ve,c as _,x as me,w as I,o as _e,b as d,D as pe,g as l,p as j,E as ge,e as n,h as o,i as r,t as p,n as N,F as A,f as U,G as fe,A as T,u as C,l as he,q as c,H as ke,k as Ce,m as i,_ as we}from"./index-CD-uQSen.js";import{u as ye}from"./comic-BkiLk8d2.js";const be={class:"reader-header"},xe={class:"container"},Se={class:"header-content"},Ve={class:"left-controls"},Ie={key:0,class:"chapter-title"},ze={class:"right-controls"},Pe={class:"settings-content"},$e={class:"setting-item"},Ae={class:"setting-item"},Te={class:"setting-item"},Be={key:0,class:"loading-container"},Fe=["src","alt"],Re={class:"page-item horizontal"},Me=["src","alt"],Le={class:"page-navigation"},Ne={class:"page-indicator"},Ue={key:2,class:"error-container"},De={key:3,class:"chapter-navigation"},Ee={class:"container"},We={class:"navigation-content"},qe={key:1},Ge={key:3},He=ce({__name:"ReaderView",setup(je){const D=me(),z=he(),w=ye(),g=m("vertical"),y=m("white"),b=m(80),P=m(!0),f=m(!1),h=m(0),k=m(null),x=m(null),{isFullscreen:B,toggle:J}=ve(),K=_(()=>w.loading),S=_(()=>w.currentPages),v=_(()=>w.currentChapter),u=_(()=>w.currentComic),$=_(()=>D.params.id),F=_(()=>{if(!u.value||!u.value.chapters||!v.value)return null;const t=u.value.chapters.findIndex(e=>{var s;return e.id===((s=v.value)==null?void 0:s.id)});return t>0?u.value.chapters[t-1]:null}),R=_(()=>{if(!u.value||!u.value.chapters||!v.value)return null;const t=u.value.chapters.findIndex(e=>{var s;return e.id===((s=v.value)==null?void 0:s.id)});return t<u.value.chapters.length-1?u.value.chapters[t+1]:null});I(()=>D.params.id,t=>{if(t){const e=Array.isArray(t)?t[0]:t;E(e),h.value=0}});async function E(t){try{await w.fetchChapterPages(t)}catch(e){console.error("加载章节页面失败",e)}}function W(){u.value?z.push(`/comic/${u.value.id}`):z.push("/")}function O(){f.value=!f.value}function Q(t){return`${t}%`}function X(){x.value&&x.value.prev()}function Y(){x.value&&x.value.next()}function Z(t){h.value=t}function q(t){z.push(`/reader/${t.id}`)}function ee(t){z.push(`/reader/${t}`)}function M(){k.value&&clearTimeout(k.value),P.value=!0,k.value=window.setTimeout(()=>{f.value||(P.value=!1)},3e3)}function te(){M()}return _e(()=>{if($.value){const L=Array.isArray($.value)?$.value[0]:$.value;E(L)}document.addEventListener("mousemove",te),M();const t=localStorage.getItem("comic-reading-mode");(t==="vertical"||t==="horizontal")&&(g.value=t);const e=localStorage.getItem("comic-background-color");(e==="white"||e==="black"||e==="sepia")&&(y.value=e);const s=localStorage.getItem("comic-image-width");s&&(b.value=parseInt(s,10))}),I(g,t=>{localStorage.setItem("comic-reading-mode",t)}),I(y,t=>{localStorage.setItem("comic-background-color",t)}),I(b,t=>{localStorage.setItem("comic-image-width",t.toString())}),I(f,t=>{t?(P.value=!0,k.value&&(clearTimeout(k.value),k.value=null)):M()}),(t,e)=>{const s=r("el-button"),L=r("el-button-group"),V=r("el-radio-button"),G=r("el-radio-group"),le=r("el-slider"),oe=r("el-drawer"),ae=r("el-skeleton"),ne=r("el-carousel-item"),se=r("el-carousel"),ie=r("el-empty"),H=r("el-icon"),re=r("el-dropdown-item"),ue=r("el-dropdown-menu"),de=r("el-dropdown");return i(),d("div",{class:N(["reader-view",{fullscreen:C(B)}])},[pe(n("div",be,[n("div",xe,[n("div",Se,[n("div",Ve,[l(s,{onClick:W,icon:"Back",plain:""},{default:o(()=>e[6]||(e[6]=[c("返回")])),_:1}),v.value?(i(),d("h2",Ie,p(v.value.title),1)):j("",!0)]),n("div",ze,[l(L,null,{default:o(()=>[l(s,{onClick:C(J),icon:(C(B),"FullScreen"),plain:""},{default:o(()=>[c(p(C(B)?"退出全屏":"全屏"),1)]),_:1},8,["onClick","icon"]),l(s,{onClick:O,icon:"Setting",plain:""},{default:o(()=>e[7]||(e[7]=[c("设置")])),_:1})]),_:1})])])])],512),[[ge,P.value]]),l(oe,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),title:"阅读设置",direction:"rtl",size:"300px"},{default:o(()=>[n("div",Pe,[n("div",$e,[e[10]||(e[10]=n("span",{class:"setting-label"},"阅读模式",-1)),l(G,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),size:"small"},{default:o(()=>[l(V,{label:"vertical"},{default:o(()=>e[8]||(e[8]=[c("垂直滚动")])),_:1}),l(V,{label:"horizontal"},{default:o(()=>e[9]||(e[9]=[c("水平翻页")])),_:1})]),_:1},8,["modelValue"])]),n("div",Ae,[e[14]||(e[14]=n("span",{class:"setting-label"},"背景颜色",-1)),l(G,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),size:"small"},{default:o(()=>[l(V,{label:"white"},{default:o(()=>e[11]||(e[11]=[c("白色")])),_:1}),l(V,{label:"black"},{default:o(()=>e[12]||(e[12]=[c("黑色")])),_:1}),l(V,{label:"sepia"},{default:o(()=>e[13]||(e[13]=[c("护眼")])),_:1})]),_:1},8,["modelValue"])]),n("div",Te,[e[15]||(e[15]=n("span",{class:"setting-label"},"图片宽度",-1)),l(le,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),min:50,max:100,step:5,"format-tooltip":Q},null,8,["modelValue"])])])]),_:1},8,["modelValue"]),K.value?(i(),d("div",Be,[l(ae,{rows:5,animated:""})])):S.value.length>0?(i(),d("div",{key:1,class:N(["reader-content",[g.value,y.value]])},[n("div",{class:"pages-container",style:fe({maxWidth:`${b.value}%`})},[g.value==="vertical"?(i(!0),d(A,{key:0},U(S.value,a=>(i(),d("div",{key:a.id,class:"page-item"},[n("img",{src:a.url,alt:`Page ${a.order}`,loading:"lazy"},null,8,Fe)]))),128)):(i(),d(A,{key:1},[l(se,{ref_key:"carousel",ref:x,autoplay:!1,"initial-index":h.value,"indicator-position":"none",height:"calc(100vh - 120px)",onChange:Z},{default:o(()=>[(i(!0),d(A,null,U(S.value,a=>(i(),T(ne,{key:a.id},{default:o(()=>[n("div",Re,[n("img",{src:a.url,alt:`Page ${a.order}`},null,8,Me)])]),_:2},1024))),128))]),_:1},8,["initial-index"]),n("div",Le,[l(s,{onClick:X,disabled:h.value===0,icon:"ArrowLeft",circle:""},null,8,["disabled"]),n("span",Ne,p(h.value+1)+" / "+p(S.value.length),1),l(s,{onClick:Y,disabled:h.value===S.value.length-1,icon:"ArrowRight",circle:""},null,8,["disabled"])])],64))],4)],2)):(i(),d("div",Ue,[l(ie,{description:"无法加载漫画内容"}),l(s,{type:"primary",onClick:W},{default:o(()=>e[16]||(e[16]=[c("返回")])),_:1})])),v.value&&u.value?(i(),d("div",De,[n("div",Ee,[n("div",We,[F.value?(i(),T(s,{key:0,onClick:e[4]||(e[4]=a=>q(F.value)),icon:"ArrowLeft"},{default:o(()=>[c(" 上一章: "+p(F.value.title),1)]),_:1})):(i(),d("span",qe)),l(de,{onCommand:ee},{dropdown:o(()=>[l(ue,null,{default:o(()=>[(i(!0),d(A,null,U(u.value.chapters,a=>(i(),T(re,{key:a.id,command:a.id,class:N({"is-active":v.value.id===a.id})},{default:o(()=>[c(p(a.title),1)]),_:2},1032,["command","class"]))),128))]),_:1})]),default:o(()=>[l(s,null,{default:o(()=>[e[17]||(e[17]=c(" 章节列表 ")),l(H,{class:"el-icon--right"},{default:o(()=>[l(C(ke))]),_:1})]),_:1})]),_:1}),R.value?(i(),T(s,{key:2,onClick:e[5]||(e[5]=a=>q(R.value)),"icon-position":"right"},{default:o(()=>[c(" 下一章: "+p(R.value.title)+" ",1),l(H,{class:"el-icon--right"},{default:o(()=>[l(C(Ce))]),_:1})]),_:1})):(i(),d("span",Ge))])])])):j("",!0)],2)}}}),Oe=we(He,[["__scopeId","data-v-62f44860"]]);export{Oe as default};
