import{d as I,r as c,v as P,w as R,o as T,x as U,b,e as a,g as s,h as n,s as K,i as r,l as M,y as $,u as j,z as D,q as f,F as E,f as G,m as V,_ as L}from"./index-CD-uQSen.js";import{u as A}from"./comic-BkiLk8d2.js";import{S as H}from"./SectionTitle-KoLAdueA.js";import{C as J}from"./ComicGrid-apJGY1A-.js";const O={class:"search-view"},Q={class:"search-form"},W={class:"search-row"},X={class:"search-input-container"},Y={class:"search-buttons"},Z={class:"filter-row"},ee={class:"filter-content"},te={class:"filter-row"},oe={class:"filter-content"},se={class:"search-results"},ae=I({__name:"SearchView",setup(le){const g=U(),w=M(),C=A(),y=c([]),p=c(!1),m=c(0),i=c(1),v=c(24),t=P({keyword:"",tags:[],sort:"newest"}),S=["热血","冒险","搞笑","恋爱","科幻","奇幻","魔法","校园","悬疑","推理","恐怖","战斗","日常","治愈","运动","历史"];R(()=>g.query,o=>{o.keyword&&(t.keyword=o.keyword,d())},{immediate:!0});async function d(){if(!(!t.keyword&&t.tags.length===0)){p.value=!0;try{w.push({path:"/search",query:{keyword:t.keyword||void 0,tags:t.tags.length>0?t.tags.join(","):void 0,sort:t.sort,page:i.value>1?i.value.toString():void 0}});const o=await C.searchComics(t.keyword,i.value,v.value);y.value=o.items,m.value=o.total}catch(o){console.error("搜索失败",o)}finally{p.value=!1}}}function x(){t.keyword="",t.tags=[],t.sort="newest",i.value=1,w.push("/search")}async function z(o,e){i.value=o,v.value=e,await d()}return T(()=>{const{keyword:o,tags:e,sort:u,page:_}=g.query;o&&(t.keyword=o),e&&(t.tags=e.split(",")),(u==="newest"||u==="popular")&&(t.sort=u),_&&(i.value=parseInt(_,10)),(t.keyword||t.tags.length>0)&&d()}),(o,e)=>{const u=r("el-icon"),_=r("el-input"),h=r("el-button"),N=r("el-option"),q=r("el-select"),k=r("el-radio-button"),B=r("el-radio-group"),F=r("el-form");return V(),b("div",O,[a("div",Q,[s(F,{model:t,onSubmit:K(d,["prevent"])},{default:n(()=>[a("div",W,[e[5]||(e[5]=a("div",{class:"search-label"},"搜索",-1)),a("div",X,[s(_,{modelValue:t.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>t.keyword=l),placeholder:"搜索漫画名称或ID",clearable:"",onKeyup:$(d,["enter"])},{prefix:n(()=>[s(u,null,{default:n(()=>[s(j(D))]),_:1})]),_:1},8,["modelValue"])]),a("div",Y,[s(h,{type:"primary",onClick:d,loading:p.value},{default:n(()=>e[3]||(e[3]=[f("搜索")])),_:1},8,["loading"]),s(h,{onClick:x},{default:n(()=>e[4]||(e[4]=[f("重置")])),_:1})])]),a("div",Z,[e[6]||(e[6]=a("div",{class:"filter-label"},"标签",-1)),a("div",ee,[s(q,{modelValue:t.tags,"onUpdate:modelValue":e[1]||(e[1]=l=>t.tags=l),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"选择标签",style:{width:"100%"}},{default:n(()=>[(V(),b(E,null,G(S,l=>s(N,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),a("div",te,[e[9]||(e[9]=a("div",{class:"filter-label"},"排序",-1)),a("div",oe,[s(B,{modelValue:t.sort,"onUpdate:modelValue":e[2]||(e[2]=l=>t.sort=l)},{default:n(()=>[s(k,{label:"newest"},{default:n(()=>e[7]||(e[7]=[f("最新更新")])),_:1}),s(k,{label:"popular"},{default:n(()=>e[8]||(e[8]=[f("最受欢迎")])),_:1})]),_:1},8,["modelValue"])])])]),_:1},8,["model"])]),a("div",se,[s(H,{title:`搜索结果 ${m.value>0?`(${m.value})`:""}`},null,8,["title"]),s(J,{comics:y.value,loading:p.value,pagination:!0,total:m.value,"default-page":i.value,"default-page-size":v.value,onPageChange:z},null,8,["comics","loading","total","default-page","default-page-size"])])])}}}),ue=L(ae,[["__scopeId","data-v-7727eecd"]]);export{ue as default};
